<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8" />
    <title>Курс валют</title>
    <style>
        body {
            color: green;
            font-family: sans-serif;
            padding: 20px;
        }
        p {
            margin: 10px 0;
        }
    </style>
</head>
<body>
<p>Курс НБУ: <span id="nbuRate">Завантаження...</span></p>
<p>Курс в Угоді: <span id="dealRate">-</span></p>
<p>Різниця у відсотках: <span id="difference">-</span></p>

<!-- Zoho SDK -->
<script src="https://live.zwidgets.com/js-sdk/1.2/ZohoEmbededAppSDK.min.js"></script>

<script>
    const NBU_API = "https://bank.gov.ua/NBUStatService/v1/statdirectory/exchange?valcode=USD&json";
    let nbuRate = null;

    // Получаем курс НБУ
    fetch(NBU_API)
        .then(res => res.json())
        .then(data => {
            nbuRate = data[0].rate;
            document.getElementById("nbuRate").textContent = nbuRate.toFixed(4);
        })
        .catch(err => {
            document.getElementById("nbuRate").textContent = "Помилка";
            console.error("Помилка при отриманні курсу НБУ:", err);
        });

    ZOHO.CRM.API.getRecord({
        Entity: "Deals",
        RecordID: "862445000000518273"
    }).then(function(data){
        console.log(data); // выведет объект записи сделки
        if(data.data && data.data.length > 0){
            const deal = data.data[0];
            const currencyRate = deal.Currency_Rate;
            console.log("Курс валюты из сделки:", currencyRate);
            // тут можешь обновить элементы страницы, например:
            document.getElementById("dealRate").textContent = currencyRate || '-';
        }
    });

</script>
</body>
</html>
